<!DOCTYPE html>
<html>
    <head>
        <title>Chat Room</title>
    </head>
    <body>
        <h1>Chat Room</h1>
        <div id="chat-log"></div>
        <input type="text" id="message-input" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>

        <script>
            //const chatSocket = new WebSocket('wss://' + window.location.host + '/ws/chat/');
            // Tự động chọn giao thức WebSocket
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const chatSocket = new WebSocket(protocol + '//' + window.location.host + '/ws/chat/');

            chatSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                document.querySelector('#chat-log').innerHTML += '<p>' + data.message + '</p>';
            };

            chatSocket.onclose = function(e) {
                console.error('Chat socket closed unexpectedly');
            };

            function sendMessage() {
                const messageInputDom = document.querySelector('#message-input');
                const message = messageInputDom.value;
                chatSocket.send(JSON.stringify({
                    'message': message
                }));
                messageInputDom.value = '';
            }
        </script>
    </body>
</html>
